<span id="status"></span>
<script type="text/javascript" src="lib/osc.min.js"></script>
<script type="text/javascript">
  const delay = 30000
  const host = "localhost"
  const port = 8080
  const ws = new OSC({
    plugin: new OSC.WebsocketClientPlugin({host, port})
  })
  const connectMessage = `Connecting to bridge at ${host}:${port}...`
  document.querySelector("#status").textContent = connectMessage
  Beat.log(connectMessage)
  ws.open()
  Beat.log("Opened.")
  Beat.callAndWait("Beat.custom.handleOpen()")
    .then(({ address }) => {
      ws.on("*", (reply) => {
        Beat.call((arg) => Beat.custom.handleReply(arg), reply)
      })
      ws.on("error", (error) => {
        Beat.call((arg) => Beat.custom.handleError(arg), error)
      })
      ws.send(new OSC.Message(address))
      Beat.log(`Sent message to ${address}`)
    }, (error) => {
      Beat.call((arg) => Beat.custom.handleError(arg), error)
    })
</script>
