<span>Connecting to localhost:8080...</span>
<script type="text/javascript" src="lib/osc.min.js"></script>
<script type="text/javascript">
  const delay = 30000
  const host = "localhost"
  const port = 8080
  const ws = new OSC({
    plugin: new OSC.WebsocketClientPlugin({host, port})
  })
  Beat.log("Opening WS at localhost:8080")
  ws.open()
  Beat.log("Opened.")
  Beat.callAndWait("Beat.custom.handleOpen()")
    .then((password) => {
      ws.on("", (reply) => {
        Beat.call((arg) => Beat.custom.handleReply(arg), reply)
      })
      ws.on("error", (error) => {
        Beat.call((arg) => Beat.custom.handleError(arg), error)
      })
      ws.send(new OSC.Message(`/connect/${password}`))
      Beat.log(`Sent connect message. Waiting ${delay / 1000} seconds...`)
      setTimeout(() => {
        const error = `Timed out after ${delay / 1000} seconds.`
        Beat.call((arg) => Beat.custom.handleError(arg), error)
      }, delay)
    }, (error) => {
      Beat.call((arg) => Beat.custom.handleError(arg), error)
    })
</script>
